{% extends "base.html" %}

{% block title %}PDF Analysis Report - {{ analysis.filename }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-8">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" id="report-content">
    <!-- Modern Header -->
    <div class="relative mb-8">
        <div class="absolute inset-0 bg-gradient-to-r from-red-500/10 to-orange-500/10 rounded-3xl blur-xl"></div>
        <div class="relative bg-gray-900/50 backdrop-blur-xl rounded-3xl p-8 border border-gray-700/30 shadow-2xl">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-red-500 to-orange-600 flex items-center justify-center shadow-lg shadow-red-500/20">
                        <i class="fas fa-file-pdf text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-orange-400">PDF Analysis Report</h1>
                        <p class="text-gray-400 mt-2 flex items-center gap-2">
                            <i class="fas fa-shield-alt text-red-400"></i>
                            <span>Multi-Engine Security Analysis</span>
                        </p>
                    </div>
                </div>
                <div class="flex flex-col items-end gap-2">
                    <div class="flex items-center gap-2 text-gray-400 text-sm">
                        <i class="fas fa-calendar text-red-400"></i>
                        <span>{{ analysis.scan_date.strftime('%Y-%m-%d %H:%M') }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-400 text-sm">
                        <i class="fas fa-database text-orange-400"></i>
                        <span>{{ analysis.engines_total if analysis.engines_total else 0 }} Engines Scanned</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File Information Card -->
    <div class="relative mb-8">
        <div class="absolute inset-0 bg-gradient-to-r {% if analysis.is_malicious %}from-red-500/5 to-orange-500/5{% else %}from-green-500/5 to-emerald-500/5{% endif %} rounded-3xl blur-xl"></div>
        <div class="relative bg-gray-900/30 backdrop-blur-xl rounded-3xl p-8 border border-gray-700/30 shadow-xl">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-8">
                <div class="flex items-start gap-6 flex-1">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br {% if analysis.is_malicious %}from-red-500/30 to-orange-600/30{% else %}from-green-500/30 to-emerald-600/30{% endif %} flex items-center justify-center border border-{% if analysis.is_malicious %}red{% else %}green{% endif %}-500/30">
                        <i class="fas fa-file-pdf {% if analysis.is_malicious %}text-red-400{% else %}text-green-400{% endif %} text-3xl"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-2xl font-bold text-white mb-3 flex items-center gap-3">
                            <span class="bg-clip-text text-transparent bg-gradient-to-r {% if analysis.is_malicious %}from-red-400 to-orange-300{% else %}from-green-400 to-emerald-300{% endif %}">File Information</span>
                        </h2>
                        <h3 class="text-xl font-semibold text-white mb-3">{{ analysis.filename }}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                            <div class="flex items-center gap-2 text-gray-300">
                                <i class="fas fa-hdd text-blue-400"></i>
                                <span>Size: <strong>{{ (analysis.file_size // 1024) if analysis.file_size else 0 }} KB</strong></span>
                            </div>
                            <div class="flex items-center gap-2 text-gray-300">
                                <i class="fas fa-fingerprint text-purple-400"></i>
                                <span>Hash: <strong>{{ analysis.file_hash[:16] if analysis.file_hash else 'N/A' }}...</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col items-center gap-4">
                    <div class="px-8 py-4 rounded-2xl text-2xl font-bold backdrop-blur-sm border
                        {% if analysis.is_malicious %} 
                        bg-red-900/30 text-red-300 border-red-500/30 shadow-lg shadow-red-500/10
                        {% else %} 
                        bg-green-900/30 text-green-300 border-green-500/30 shadow-lg shadow-green-500/10
                        {% endif %}">
                        {% if analysis.is_malicious %}MALICIOUS{% else %}SAFE{% endif %}
                    </div>
                    <div class="text-center">
                        <div class="text-sm text-gray-400 mb-1">Threat Level</div>
                        <div class="flex gap-1">
                            {% if analysis.is_malicious %}
                                {% for i in range(5) %}
                                <div class="w-8 h-2 rounded-full {% if i < 4 %}bg-red-500{% else %}bg-gray-700{% endif %}"></div>
                                {% endfor %}
                            {% else %}
                                {% for i in range(5) %}
                                <div class="w-8 h-2 rounded-full {% if i < 1 %}bg-green-500{% else %}bg-gray-700{% endif %}"></div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Summary -->
    <div class="relative mb-8">
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/5 to-blue-500/5 rounded-3xl blur-xl"></div>
        <div class="relative bg-gray-900/30 backdrop-blur-xl rounded-3xl p-8 border border-gray-700/30 shadow-xl">
            <h2 class="text-2xl font-bold text-white mb-8 flex items-center gap-3">
                <i class="fas fa-chart-pie text-cyan-400"></i>
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-300">Scan Results Summary</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-gradient-to-br from-gray-800/80 to-gray-900/80 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/30 hover:border-blue-500/50 transition-all duration-300 transform hover:-translate-y-1">
                <div class="flex items-center mb-3">
                    <i class="fas fa-check-circle text-blue-400 text-xl mr-2"></i>
                    <h3 class="font-semibold text-white">Clean Engines</h3>
                </div>
                <p class="text-3xl font-bold text-blue-400">{{ analysis.engines_total - analysis.engines_detected if analysis.engines_total else 0 }}</p>
                <div class="mt-3">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-blue-500 h-2.5 rounded-full"
                             style="width: {{ ((analysis.engines_total - analysis.engines_detected) / analysis.engines_total * 100) if analysis.engines_total and analysis.engines_total > 0 else 0 }}%">
                        </div>
                    </div>
                    <p class="text-sm text-gray-300 mt-1">
                        Safety Ratio: {{ '%.1f'|format(((analysis.engines_total - analysis.engines_detected) / analysis.engines_total * 100) if analysis.engines_total and analysis.engines_total > 0 else 0) }}%
                    </p>
                </div>
            </div>

            <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-4 border-t-4 border-red-500">
                <div class="flex items-center mb-3">
                    <i class="fas fa-exclamation-triangle text-red-400 text-xl mr-2"></i>
                    <h3 class="font-semibold text-white">Malicious Engines</h3>
                </div>
                <p class="text-3xl font-bold text-red-400">{{ analysis.engines_detected if analysis.engines_detected else 0 }}</p>
                <div class="mt-3">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-red-500 h-2.5 rounded-full"
                             style="width: {{ (analysis.engines_detected / analysis.engines_total * 100) if analysis.engines_total and analysis.engines_total > 0 else 0 }}%">
                        </div>
                    </div>
                    <p class="text-sm text-gray-300 mt-1">
                        Risk Ratio: {{ '%.1f'|format((analysis.engines_detected / analysis.engines_total * 100) if analysis.engines_total and analysis.engines_total > 0 else 0) }}%
                    </p>
                </div>
            </div>

            <div class="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-4 border-t-4 border-yellow-500">
                <div class="flex items-center mb-3">
                    <i class="fas fa-shield-alt text-yellow-400 text-xl mr-2"></i>
                    <h3 class="font-semibold text-white">Confidence Score</h3>
                </div>
                <p class="text-3xl font-bold text-yellow-400">{{ analysis.threat_score if analysis.threat_score else 0 }}%</p>
                <div class="mt-3">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-yellow-500 h-2.5 rounded-full"
                             style="width: {{ analysis.threat_score if analysis.threat_score else 0 }}%">
                        </div>
                    </div>
                    <p class="text-sm text-gray-300 mt-1">
                        Confidence level in result
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Engine Results -->
    <div class="bg-white/10 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 card-hover border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600">
            <i class="fas fa-cogs mr-2"></i> Scan Engine Results
        </h2>

        {% if results %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-900">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Scan Engine</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Result</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Details</th>
                    </tr>
                </thead>
                <tbody class="bg-gray-800/50 backdrop-blur-sm rounded-2xl divide-y divide-gray-700">
                    {% for engine_name, engine_result in results.items() %}
                    <tr class="hover:bg-gray-700/50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-blue-300">
                            <div class="flex items-center">
                                {% if engine_name == 'virustotal' %}
                                <i class="fas fa-shield-alt text-blue-400 mr-2"></i>
                                {% elif engine_name == 'metadefender' %}
                                <i class="fas fa-cloud text-green-400 mr-2"></i>
                                {% else %}
                                <i class="fas fa-search text-yellow-400 mr-2"></i>
                                {% endif %}
                                {{ engine_name | title }}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-bold rounded-full
                                {% if not engine_result.error %} bg-green-900 text-green-100
                                {% else %} bg-red-900 text-red-100 {% endif %}">
                                {% if not engine_result.error %}Completed
                                {% else %}Failed{% endif %}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm
                            {% if engine_result.detected %} text-red-400
                            {% elif engine_result.error %} text-yellow-400
                            {% else %} text-green-400 {% endif %}">
                            {% if engine_result.detected %}Malicious
                            {% elif engine_result.error %}Error
                            {% else %}Clean{% endif %}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-300">
                            {% if engine_result.error %}
                                {{ engine_result.error }}
                            {% elif engine_result.detected %}
                                Detected by {{ engine_result.positives if engine_result.positives else 'multiple' }} engines
                            {% else %}
                                No threats detected
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-8">
            <div class="inline-block p-4 bg-gray-700 rounded-full mb-4">
                <i class="fas fa-exclamation-circle text-gray-400 text-4xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-400 mb-2">No Results Available</h3>
            <p class="text-gray-500">No analysis results found from the engines.</p>
        </div>
        {% endif %}
    </div>

    <!-- Detected Threats -->
    {% if vulnerabilities and vulnerabilities|length > 0 %}
    <div class="bg-white/10 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 card-hover border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600">
            <i class="fas fa-bug mr-2"></i> Detected Threats
        </h2>

        <div class="space-y-4">
            {% for threat in vulnerabilities %}
            <div class="bg-gray-900/50 rounded-lg p-4 border-l-4
                {% if threat.severity == 'high' %} border-red-500
                {% elif threat.severity == 'medium' %} border-yellow-500
                {% else %} border-orange-500 {% endif %}">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="font-bold text-white flex items-center">
                            {% if threat.severity == 'high' %}
                            <i class="fas fa-exclamation-circle text-red-400 mr-2"></i>
                            {% elif threat.severity == 'medium' %}
                            <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                            {% else %}
                            <i class="fas fa-info-circle text-orange-400 mr-2"></i>
                            {% endif %}
                            {{ threat.type if threat.type else 'Unknown Threat' }}
                        </h3>
                        <p class="text-gray-300 mt-1">{{ threat.description if threat.description else 'No description available' }}</p>
                        {% if threat.position %}
                        <p class="text-sm text-gray-400 mt-2">{{ threat.position }}</p>
                        {% endif %}
                    </div>
                    <span class="px-3 py-1 rounded-full text-sm font-bold
                        {% if threat.severity == 'high' %} bg-red-500/30 text-red-300
                        {% elif threat.severity == 'medium' %} bg-yellow-500/30 text-yellow-300
                        {% else %} bg-orange-500/30 text-orange-300 {% endif %}">
                        {% if threat.severity == 'high' %}High
                        {% elif threat.severity == 'medium' %}Medium
                        {% else %}Low{% endif %}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="bg-white/10 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 card-hover border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600">
            <i class="fas fa-bug mr-2"></i> Detected Threats
        </h2>
        <div class="text-center py-8">
            <div class="inline-block p-4 bg-green-900/30 rounded-full mb-4">
                <i class="fas fa-check-circle text-green-400 text-4xl"></i>
            </div>
            <h3 class="text-xl font-bold text-green-400 mb-2">No Threats Detected!</h3>
            <p class="text-gray-300">The file appears to be safe based on the conducted scans.</p>
        </div>
    </div>
    {% endif %}

    <!-- File Analysis -->
    <div class="bg-white/10 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 card-hover border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600">
            <i class="fas fa-chart-bar mr-2"></i> File Analysis
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-700">
                <h3 class="font-semibold text-white mb-3">File Information</h3>
                <ul class="space-y-2">
                    <li class="flex justify-between">
                        <span class="text-gray-400">Filename:</span>
                        <span class="font-medium text-white">{{ analysis.filename }}</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Size:</span>
                        <span class="font-medium text-white">{{ (analysis.file_size // 1024) if analysis.file_size else 0 }} KB</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">File Type:</span>
                        <span class="font-medium text-white">PDF</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Page Count:</span>
                        <span class="font-medium text-white">
                            {% if file_metadata and file_metadata.structure and file_metadata.structure.pages %}
                                {{ file_metadata.structure.pages }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Creation Date:</span>
                        <span class="font-medium text-white">
                            {% if file_metadata and file_metadata.metadata and file_metadata.metadata.get('CreationDate') %}
                                {{ file_metadata.metadata.CreationDate }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </span>
                    </li>
                </ul>
            </div>

            <div class="bg-gray-900/50 rounded-lg p-4 border border-gray-700">
                <h3 class="font-semibold text-white mb-3">Scan Statistics</h3>
                <ul class="space-y-2">
                    <li class="flex justify-between">
                        <span class="text-gray-400">Scan Engines:</span>
                        <span class="font-medium text-white">{{ analysis.engines_total if analysis.engines_total else 0 }}</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Clean Engines:</span>
                        <span class="font-medium text-green-400">{{ analysis.engines_total - analysis.engines_detected if analysis.engines_total else 0 }}</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Malicious Engines:</span>
                        <span class="font-medium text-red-400">{{ analysis.engines_detected if analysis.engines_detected else 0 }}</span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Threat Level:</span>
                        <span class="font-medium
                            {% if analysis.threat_score and analysis.threat_score > 70 %} text-red-400
                            {% elif analysis.threat_score and analysis.threat_score > 30 %} text-yellow-400
                            {% else %} text-green-400 {% endif %}">
                            {{ analysis.threat_score if analysis.threat_score else 0 }}%
                        </span>
                    </li>
                    <li class="flex justify-between">
                        <span class="text-gray-400">Scan Duration:</span>
                        <span class="font-medium text-white">
                            {% if file_metadata and file_metadata.scan_duration %}
                                {{ file_metadata.scan_duration }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Additional File Structure Information -->
        {% if file_metadata and file_metadata.structure %}
        <div class="mt-6 bg-gray-900/50 rounded-lg p-4 border border-gray-700">
            <h3 class="font-semibold text-white mb-3">File Structure Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <span class="text-gray-400">JavaScript:</span>
                    <span class="font-medium {% if file_metadata.structure.javascript %}text-red-400{% else %}text-green-400{% endif %}">
                        {{ 'Present' if file_metadata.structure.javascript else 'Not Present' }}
                    </span>
                </div>
                <div>
                    <span class="text-gray-400">Forms:</span>
                    <span class="font-medium {% if file_metadata.structure.forms %}text-yellow-400{% else %}text-green-400{% endif %}">
                        {{ 'Present' if file_metadata.structure.forms else 'Not Present' }}
                    </span>
                </div>
                <div>
                    <span class="text-gray-400">Embedded Files:</span>
                    <span class="font-medium {% if file_metadata.structure.embedded_files %}text-red-400{% else %}text-green-400{% endif %}">
                        {{ 'Present' if file_metadata.structure.embedded_files else 'Not Present' }}
                    </span>
                </div>
                <div>
                    <span class="text-gray-400">Text Length:</span>
                    <span class="font-medium text-white">
                        {% if file_metadata.text_length %}
                            {{ file_metadata.text_length }} characters
                        {% else %}
                            Unknown
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <!-- Suspicious Objects -->
            {% if file_metadata.suspicious_objects and file_metadata.suspicious_objects|length > 0 %}
            <div class="mt-4">
                <h4 class="font-semibold text-yellow-400 mb-2">Suspicious Objects:</h4>
                <ul class="list-disc list-inside text-gray-300">
                    {% for obj in file_metadata.suspicious_objects %}
                    <li>{{ obj }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Security Recommendations -->
    <div class="bg-white/10 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 card-hover border border-gray-700">
        <h2 class="text-xl font-bold text-white mb-4 pb-2 border-b border-gray-600">
            <i class="fas fa-lightbulb mr-2"></i> Security Recommendations
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-gray-900/50 rounded-lg p-4 border border-blue-500">
                <h3 class="font-semibold text-blue-400 mb-3">
                    <i class="fas fa-shield-alt mr-2"></i> Preventive Measures
                </h3>
                <ul class="list-disc list-inside pl-2 space-y-2">
                    <li class="text-gray-300">Avoid opening PDF files from untrusted sources</li>
                    <li class="text-gray-300">Update your PDF reader to the latest version</li>
                    <li class="text-gray-300">Disable JavaScript in PDF reader if not necessary</li>
                    <li class="text-gray-300">Use updated antivirus software</li>
                    <li class="text-gray-300">Scan suspicious files before opening them</li>
                </ul>
            </div>

            <div class="bg-gray-900/50 rounded-lg p-4 border border-red-500">
                <h3 class="font-semibold text-red-400 mb-3">
                    <i class="fas fa-exclamation-triangle mr-2"></i> Remediation Measures
                </h3>
                <ul class="list-disc list-inside pl-2 space-y-2">
                    <li class="text-gray-300">Delete the file immediately if it's malicious</li>
                    <li class="text-gray-300">Scan the system using antivirus software</li>
                    <li class="text-gray-300">Review system logs for any suspicious activity</li>
                    <li class="text-gray-300">Change passwords if the file has been opened</li>
                    <li class="text-gray-300">Keep backups of important data</li>
                </ul>
            </div>
        </div>

        {% if analysis.is_malicious %}
        <div class="mt-6 bg-red-900/30 rounded-lg p-4 border border-red-500">
            <h3 class="font-semibold text-red-400 mb-3">
                <i class="fas fa-exclamation-circle mr-2"></i> Security Alert
            </h3>
            <p class="text-gray-300">
                This file has been classified as malicious. It is recommended not to open it and delete it immediately from your system.
                If the file has been previously opened, scan your system using an updated antivirus program.
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Report Actions -->
    <div class="relative mb-8">
        <div class="absolute inset-0 bg-gradient-to-r from-red-500/5 to-orange-500/5 rounded-3xl blur-xl"></div>
        <div class="relative bg-gray-900/30 backdrop-blur-xl rounded-3xl p-8 border border-gray-700/30 shadow-xl">
            <h2 class="text-2xl font-bold text-white mb-8 text-center flex items-center justify-center gap-3">
                <i class="fas fa-tasks text-red-400"></i>
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-orange-300">Report Actions</span>
            </h2>

            <div class="flex flex-wrap gap-4 justify-center">
                <a href="{{ url_for('pdf_analysis') }}"
                   class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-semibold rounded-xl hover:from-blue-700 hover:to-indigo-800 transition-all transform hover:-translate-y-1 hover:shadow-lg hover:shadow-blue-500/20 flex items-center justify-center gap-2">
                    <i class="fas fa-redo"></i> New Analysis
                </a>

                <a href="{{ url_for('dashboard') }}"
                   class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-semibold rounded-xl hover:from-indigo-700 hover:to-purple-800 transition-all transform hover:-translate-y-1 hover:shadow-lg hover:shadow-indigo-500/20 flex items-center justify-center gap-2">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>

                <button onclick="printReport()"
                        class="px-8 py-4 bg-gradient-to-r from-green-600 to-teal-600 text-white font-semibold rounded-xl hover:from-green-700 hover:to-teal-700 transition-all transform hover:-translate-y-1 hover:shadow-lg hover:shadow-green-500/20 flex items-center justify-center gap-2">
                    <i class="fas fa-print"></i> Print
                </button>

                <button onclick="shareReport()"
                        class="px-8 py-4 bg-gradient-to-r from-cyan-600 to-blue-700 text-white font-semibold rounded-xl hover:from-cyan-700 hover:to-blue-800 transition-all transform hover:-translate-y-1 hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center gap-2">
                    <i class="fas fa-share-alt"></i> Share
                </button>

                <button onclick="confirmDelete('pdf', '{{ analysis.id }}')"
                        class="px-8 py-4 bg-gradient-to-r from-red-600 to-red-800 text-white font-semibold rounded-xl hover:from-red-700 hover:to-red-900 transition-all transform hover:-translate-y-1 hover:shadow-lg hover:shadow-red-500/20 flex items-center justify-center gap-2">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-gray-800 rounded-2xl p-6 w-96">
        <h3 class="text-xl font-bold text-white mb-4">Confirm Deletion</h3>
        <p class="text-gray-300 mb-6">Are you sure you want to delete this report? This action cannot be undone.</p>
        <div class="flex justify-end space-x-3">
            <button onclick="closeDeleteModal()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                Cancel
            </button>
            <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                Confirm Delete
            </button>
        </div>
    </div>
</div>

<script>
// Delete Confirmation Modal
let currentAnalysisId = null;

function confirmDelete(analysisId) {
    currentAnalysisId = analysisId;
    document.getElementById('deleteModal').classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    currentAnalysisId = null;
}

// Confirm Delete Action
document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    if (currentAnalysisId) {
        fetch(`/delete_pdf_report/${currentAnalysisId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Report deleted successfully');
                window.location.href = "{{ url_for('dashboard') }}";
            } else {
                alert('Failed to delete report: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while trying to delete');
        })
        .finally(() => {
            closeDeleteModal();
        });
    }
});

// Close modal when clicking outside
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target.id === 'deleteModal') {
        closeDeleteModal();
    }
});

// Share Report
function shareReport() {
    const reportUrl = window.location.href;

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(reportUrl).then(() => {
            alert('Report URL copied to clipboard: ' + reportUrl);
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert('Could not copy the link. Please try again.');
        });
    } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = reportUrl;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            alert('Report URL copied to clipboard: ' + reportUrl);
        } catch (err) {
            console.error('Fallback copy failed: ', err);
            alert('Could not copy the link. Please try again.');
        }
        document.body.removeChild(textArea);
    }
}

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeDeleteModal();
    }
});
</script>

<style>
.card-hover {
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.card-hover:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(139, 92, 246, 0.3);
}

.gradient-bg {
    background: linear-gradient(90deg, #3B82F6 0%, #8B5CF6 100%);
}
</style>
{% endblock %}